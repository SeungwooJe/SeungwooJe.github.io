<!DOCTYPE html>
<html>
<head>
    <title>Assignment Submission and Download</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.21.1/axios.min.js"></script>
</head>
<body>
    <h2>Assignment Submission Form</h2>
    <form id="submission-form">
        <label for="name">Name:</label><br>
        <input type="text" id="name" name="name" required><br>
        <label for="student_id">Student ID:</label><br>
        <input type="text" id="student_id" name="student_id" required><br>
        <label for="advisor">Advisor:</label><br>
        <input type="text" id="advisor" name="advisor" required><br>
        <label for="file">File:</label><br>
        <input type="file" id="file" name="file" required><br><br>
        <input type="submit" value="Submit">
    </form>

    <div id="submission-status"></div>

    <h2>Download Files</h2>
    <button onclick="list_files()">List Files</button>
    <div id="file-list"></div>

    <script>
        document.getElementById('submission-form').addEventListener('submit', async function(event) {
            event.preventDefault();

            const form = event.target;
            const formData = new FormData(form);

            const name = formData.get('name');
            const student_id = formData.get('student_id');
            const advisor = formData.get('advisor');
            const file = formData.get('file');

            try {
                const response = await axios.post('/upload', formData, {
                    headers: {
                        'Content-Type': 'multipart/form-data'
                    }
                });

                const file_url = response.data.url;

                const xml_data = new Blob([create_xml(name, student_id, advisor, new Date(), file_url)], {type: 'text/xml'});
                const xml_formData = new FormData();
                xml_formData.append('file', xml_data, `${student_id}_submission.xml`);

                await axios.post('/upload', xml_formData, {
                    headers: {
                        'Content-Type': 'multipart/form-data'
                    }
                });

                document.getElementById('submission-status').innerText = 'Assignment successfully submitted!';
            } catch (error) {
                console.error(error);
                document.getElementById('submission-status').innerText = 'Failed to submit assignment.';
            }
        });

        async function list_files() {
            try {
                const response = await axios.get('/list_files');
                const files = response.data;

                const file_list_div = document.getElementById('file-list');
                file_list_div.innerHTML = '';

                files.forEach(file => {
                    const file_link = document.createElement('a');
                    file_link.href = file.url;
                    file_link.textContent = file.name;
                    file_link.download = file.name;

                    const list_item = document.createElement('div');
                    list_item.appendChild(file_link);
                    file_list_div.appendChild(list_item);
                });
            } catch (error) {
                console.error(error);
                document.getElementById('file-list').innerText = 'Failed to list files.';
            }
        }

        function create_xml(name, student_id, advisor, submission_time, file_path) {
            const xmlDoc = document.implementation.createDocument('', '', null);
            const submission = xmlDoc.createElement('submission');

            const nameElem = xmlDoc.createElement('name');
            nameElem.textContent = name;
            submission.appendChild(nameElem);

            const studentIdElem = xmlDoc.createElement('student_id');
            studentIdElem.textContent = student_id;
            submission.appendChild(studentIdElem);

            const advisorElem = xmlDoc.createElement('advisor');
            advisorElem.textContent = advisor;
            submission.appendChild(advisorElem);

            const submissionTimeElem = xmlDoc.createElement('submission_time');
            submissionTimeElem.textContent = submission_time.toISOString();
            submission.appendChild(submissionTimeElem);

            const filePathElem = xmlDoc.createElement('file_path');
            filePathElem.textContent = file_path;
            submission.appendChild(filePathElem);

            return new XML#### `index.html` (계속)
```html
            return new XMLSerializer().serializeToString(submission);
        }
    </script>
</body>
</html>
