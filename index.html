<!DOCTYPE html>
<html>
<head>
    <title>Assignment Submission</title>
    <link rel="stylesheet" href="https://pyscript.net/latest/pyscript.css" />
    <script defer src="https://pyscript.net/latest/pyscript.js"></script>
</head>
<body>
    <h2>Assignment Submission Form</h2>
    <form id="submission-form">
        <label for="name">Name:</label><br>
        <input type="text" id="name" name="name" required><br>
        <label for="student_id">Student ID:</label><br>
        <input type="text" id="student_id" name="student_id" required><br>
        <label for="advisor">Advisor:</label><br>
        <input type="text" id="advisor" name="advisor" required><br>
        <label for="file">File:</label><br>
        <input type="file" id="file" name="file" required><br><br>
        <input type="submit" value="Submit">
    </form>

    <div id="submission-status"></div>

    <py-script>
        from datetime import datetime
        import pytz
        import xml.etree.ElementTree as ET
        import js

        def create_xml(name, student_id, advisor, submission_time, file_path):
            submission = ET.Element("submission")
            ET.SubElement(submission, "name").text = name
            ET.SubElement(submission, "student_id").text = student_id
            ET.SubElement(submission, "advisor").text = advisor
            ET.SubElement(submission, "submission_time").text = submission_time
            ET.SubElement(submission, "file_path").text = file_path
            return ET.tostring(submission, encoding='unicode', method='xml')

        async def handle_form_submit(event):
            event.preventDefault()

            form = js.document.getElementById("submission-form")
            formData = js.FormData.new(form)

            name = formData.get("name")
            student_id = formData.get("student_id")
            advisor = formData.get("advisor")
            file = formData.get("file")

            beijing_tz = pytz.timezone('Asia/Shanghai')
            submission_time = datetime.now(beijing_tz).strftime('%Y-%m-%d %H:%M:%S')

            # Simulate file upload to OneDrive
            file_path = f"/onedrive/path/{file.name}"

            xml_data = create_xml(name, student_id, advisor, submission_time, file_path)
            xml_filename = f"{student_id}_submission.xml"
            with open(xml_filename, 'w') as xml_file:
                xml_file.write(xml_data)

            # Simulate XML file upload to OneDrive
            xml_file_path = f"/onedrive/path/{xml_filename}"

            # Display submission status
            status_div = js.document.getElementById("submission-status")
            status_div.innerHTML = "Assignment successfully submitted!"

        form = js.document.getElementById("submission-form")
        form.addEventListener("submit", handle_form_submit)
    </py-script>
</body>
</html>
